<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Mariner</title>
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.css">
	<link rel="stylesheet" href="css/styles.css">
	<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.js"></script>
	<script src="js/mariner.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
	<script type="text/javascript" src="phonegap.js"></script>

</head>

<body>

<div data-role="page" id="home">
<script>
	document.addEventListener("deviceready", onDeviceReady, false);

    // Cordova is ready
    //
    function onDeviceReady() {
        var db = window.openDatabase("MarineDB", "1.0", "Marine Weather", 200000);
        db.transaction(populateDB, errorCB, successCB);
    }

    // Populate the database 
    //
    function populateDB(tx) {
         tx.executeSql('CREATE TABLE IF NOT EXISTS STATIONS (stationID INTEGER PRIMARY KEY, stationName VARCHAR(70), lat VARCHAR(20), lon VARCHAR(20))');
        
		//fetch stations
		  $.ajax({
			type: "GET",
			url: "http://opendap.co-ops.nos.noaa.gov/axis/webservices/activestations/response.jsp?v=2&format=xml",
			dataType: "xml",
			success: function(xml){
			
			$(xml).find("stationV2").each(function() {
			
			$stationName = $(this).attr("name");
			$stationID = $(this).attr("ID");
			$stationState = $(this).find("state").text();
			$lat = $(this).find("lat").text();
			$lon = $(this).find("long").text();
			
			$fullName = $stationName + ", " + $stationState;

			//tx.executeSql("INSERT INTO STATIONS (stationID, stationName, lat, lon) VALUES (" + $stationID + ",'" + $fullName + "','" + $lat + "','" + $lon + "')");
			}
			alert('success');
			}
		  });
		}

    // Transaction error callback
    //
    function errorCB(tx, err) {
        alert("Error processing SQL: "+err);
    }

    // Transaction success callback
    //
    function successCB() {
        alert("success!");
    }

	
	
	
	$( document ).delegate("#home", "pageinit", function() {
	$("#app-menu").click(function(e){
		  $("#main-menu").panel( "open" );
		});

		$('#current-location').click(function() {
		  $("#stations-panel").panel( "open" );
		});
		
		$('#add-location').click(function() {
		  $("#stations-panel").panel( "close" );  
			
			alert('open location');
			
			
			
					  
		});
	});
	
</script>
<div data-role="panel" id="main-menu" data-position="left" data-display="overlay">
    <h3>mariner</h3>
		<ul class="main-menu-nav">
			<li><a href="index.html" data-transition="slide">Current Conditions</a></li>
			<li><a href="details.html" data-transition="slide">Detailed View</a></li>
			<li><a href="map.html" data-transition="slide" id="map">Weather Map</a></li>
			<li><a href="forecast.html" data-transition="slide">Weekly Forecast</a></li>
			<li><a href="#">Current Alerts</a></li>
			<li><a href="tides.html">Tide Chart</a></li>
			<li><a href="fishing.html">Fishing Forecast</a></li>
		</ul>
</div><!-- /menu panel -->

<div data-role="panel" id="stations-panel" data-position="left" data-display="overlay">
    <h3>My Locations</h3>
		<ul id="locations">
			<!--<li><a href="#" id="70458">Slidell, LA</a></li>
			<li><a href="#" id="28857">Morehead City, NC</a></li>
			<li><a href="#" id="30123">Bay St. Louis, MS</a></li>-->
		</ul>
		<h4 id="add-location">Add Location</h4>
</div><!-- /menu panel -->
	
	
	<div data-role="header" data-position="fixed" id="main-header">
		<div id="app-header">
			<h1>mariner</h1>
			<a href="#" id="app-menu"><img src="images/icons/menu.png" /></a>
		</div>
	</div><!-- /header -->

	<div data-role="content">	
		<div id="banner"></div>
		
		<h2 id="current-location">Unknown</h2>
		
		<ul id="current-conditions">
			<li id="water-temp">WATER TEMP <span class="obs">N/A</span></li>
			<li id="tides">CURRENT TIDE <span class="obs">N/A</span></li>
			<li id="waves">WAVES <span class="obs">N/A</span></li>
			<li id="winds">WINDS <span class="obs">N/A</span></li>
			<!--<li id="station"><a href="#" id="find-stations">BAYOU BON FOUCA, LA</a></li>-->
		</ul>
		
		<select id="local-stations">
			<!--<option>BAYOU BON FOUCA, LA</option>
			<option>SHELL BEACH, LA</option>
			<option>GRAND ISLE, LA</option>-->
		</select>
		
	</div><!-- /content -->
	
</div><!-- /page -->

</body>
</html>
